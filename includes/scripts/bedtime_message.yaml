bedtime_message:
  sequence:
    - wait_template: "{{ is_state('media_player.bedroom', 'idle') or is_state('media_player.bedroom', 'off') }}"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.bedroom
        volume_level: 0.5
    - service: tts.google_translate_say
      entity_id: media_player.bedroom
      data_template:
        message: >
          Good night {{ states.sensor.who_is_home.state }}.
          {% if is_state('input_boolean.alarm_clock', 'on') %}
          Your alarm is set for {{ states.sensor.alarm_time.state }}AM.
          {% endif %}
          Tomorrow the weather will be {{ states.sensor.darksky_summary_1d.state }} with highs of {{ states. sensor.darksky_daytime_high_temperature_1d.state }} degrees celcius.
          {{ [
          "Sweet dreams!",
          "Sleep tight!",
          "Sleep well!",
          "Rest your weary head!",
          "Good night",
          "Night night",
          "Until tomorrow..good night.",
          "Seeya!",
          "Have a great sleep",
          "Dream of powderdust and unicorns and glitter and pink and sparkles.",
          "Powering down...",
          "Rest up",
          "Please don't snore tonight.",
          "Good night, sleep tight, hope the bedbugs don't bite",
          "Sweet dreams are made of this",
          "Dream a little dream of me"
          ] | random }}
    - wait_template: "{{ is_state('media_player.bedroom', 'idle') }}"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.bedroom
        volume_level: 0.2
