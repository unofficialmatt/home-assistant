rain_warning:
  sequence:
    - service: scene.turn_on
      entity_id: scene.rain_warning
    - service_template: >
        {% if is_state('sensor.who_is_home', 'Sarah and Matt') %}
          notify.all_phones
        {% elif is_state('sensor.who_is_home', 'Sarah') %}
          notify.sarah
        {% else %}
          notify.matt
        {% endif %}
      data_template:
        title: >
          {{ "\uD83C\uDF27" }} Rain Warning
        message: >
          There is a {{states('sensor.chance_of_rain')}}% chance it might rain soon! There is a storm {{ states. sensor.darksky_nearest_storm_distance.state }} miles away.
        data:
          attachment:
            url: https://api.sat24.com/animated/GB/rainTMC/3/GMT%20Standard%20Time/4260619
            content-type: gif
            hide-thumbnail: false
    - delay: '00:00:10' 
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.speakers
        volume_level: 0.50
    - wait_template: "{{ is_state('media_player.speakers', 'idle') or is_state('media_player.speakers', 'off') }}"
    - service: tts.google_translate_say
      entity_id: media_player.speakers
      data_template:
        message: >
          This is a weather alert from Home Assistant. There is a {{states('sensor.chance_of_rain')}} percent chance it might rain soon! There is a storm {{ states. sensor.darksky_nearest_storm_distance.state }} miles away.
    - service: notify.alexa_media
      data_template:
        entity_id: media.player.dining_room
        message: >
          This is a weather alert from Home Assistant. There is a {{states('sensor.chance_of_rain')}} percent chance it might rain soon! There is a storm {{ states. sensor.darksky_nearest_storm_distance.state }} miles away.
    - wait_template: "{{ is_state('media_player.speakers', 'idle') }}"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.speakers
        volume_level: 0.2